<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link th:href="@{/styles.css}" rel="stylesheet" />
    <!-- <link href="../static/styles.css" rel="stylesheet" /> -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<body>

<div class="main">
    <form method="GET" th:action="@{/api/search}" style="display: flex;">
        <div class="rbtn">
            <fieldset>
                <legend>Выберите режим поиска</legend>

                <div>
                    <input type="radio" id="apache" name="method" value="apache" checked />
                    <label for="apache">Классический</label>
                </div>

                <div>
                    <input type="radio" id="neural" name="method" value="neural" />
                    <label for="neural">Нейронный</label>
                </div>

                <div>
                    <input type="radio" id="combo" name="method" value="combo" />
                    <label for="combo">Комбинированный</label>
                </div>
            </fieldset>
        </div>
        <div class="d1">
            <input name="search_param" placeholder="Искать здесь..." th:value="${search_param}" type="search">
            <button id="btn" type="submit"></button>
        </div>
    </form>
</div>

<div class="loading-spinner"></div>

<div id="search-results"></div>

</body>
<script>
    $(document).ready(function() {
        $('form').submit(function(event) {
            event.preventDefault();

            // Блокировка кнопки
            let btn = document.getElementById("btn");
            btn.disabled = true; 

            var form = $(this);
            var formData = form.serialize();

            // Отобразить колесо загрузки
            $('.loading-spinner').show();

            // Отправить AJAX-запрос на бэкенд
            $.ajax({
                type: form.attr('method'),
                url: form.attr('action'),
                data: formData,
                success: function(response) {
                    // Скрыть колесо загрузки
                    $('.loading-spinner').hide();

                    // Очистить текущие результаты
                    $('#search-results').empty();

                    // Обработать полученные результаты
                    response.forEach(function(result) {
                        var resultElement = $('<div class="search_res"></div>');
                        resultElement.append('<p>Имя файла: <span>' + result.shortFileName + '</span></p>');
                        resultElement.append('<details><summary>Краткий ответ: <span>' + (result.Answer ? result.Answer : "") + '</span></summary><p>' + result.PageText + '</p></details>');
                        resultElement.append('<p>Вероятность: <span>' + result.Coincidence + '</span></p>');

                        // Добавить результат в контейнер для результатов поиска
                        $('#search-results').append(resultElement);
                    });
                    btn.disabled = false;
                },
                error: function(error) {
                    // Скрыть колесо загрузки в случае ошибки
                    $('.loading-spinner').hide();
                    console.error('Error:', error);
                    btn.disabled = false;
                }
            });

            
        });
    });
</script>
</html>